[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Clojure Data Cookbook",
    "section": "",
    "text": "1 Preface\nWelcome to the Clojure Data Cookbook! This is the website for the work-in-progress that will become the Clojure Data Cookbook. The goal is to provide a reference for anyone who has data to work with and an interest in doing it in Clojure, documenting the current community recommendations and default stack for data science in Clojure."
  },
  {
    "objectID": "index.html#test",
    "href": "index.html#test",
    "title": "book",
    "section": "1.1 TEST",
    "text": "1.1 TEST\n\n(kind/hiccup\n [:a {:href \"chapter_1_intro/1_1_welcome.html\"}\n  \"THIS IS THE LINK\"])\n\n\nTHIS IS THE LINK"
  },
  {
    "objectID": "index.html#note-all-work-here-is-in-progress-subject-to-change-very-messy-and-partially-done.-please-bear-with-me-as-i-work-on-through-this-project-d",
    "href": "index.html#note-all-work-here-is-in-progress-subject-to-change-very-messy-and-partially-done.-please-bear-with-me-as-i-work-on-through-this-project-d",
    "title": "Clojure Data Cookbook",
    "section": "1.1 Note! all work here is in progress, subject to change, very messy, and partially done. Please bear with me as I work on through this project :D",
    "text": "1.1 Note! all work here is in progress, subject to change, very messy, and partially done. Please bear with me as I work on through this project :D\n\n\n\n\nContents\n\n\n\nchapter_1_intro\n\n\nChapter_1_intro/1_1_welcome.html\n\n\nChapter_1_intro/1_2_why_clojure.html\n\n\nChapter_1_intro/1_3_set_up.html\n\n\n\n\nchapter_2_input_output\n\n\nChapter_2_input_output/2_1_loading_data.html\n\n\nChapter_2_input_output/2_2_messy_data.html\n\n\nChapter_2_input_output/2_3_exporting_data.html\n\n\n\n\nchapter_3_data_manipulation\n\n\nChapter_3_data_manipulation/3_data_manipulation.html\n\n\n\n\nchapter_4_data_visualisation\n\n\nChapter_4_data_visualisation/4_2_graphs.html\n\n\nChapter_4_data_visualisation/noj_examples.html\n\n\n\n\n\n\n\n\nsource: book/index.clj"
  },
  {
    "objectID": "chapter_2_input_output/2_2_messy_data.html#multiple-types-mixed-in-one-column",
    "href": "chapter_2_input_output/2_2_messy_data.html#multiple-types-mixed-in-one-column",
    "title": "5  Dealing with messy data",
    "section": "5.1 Multiple types mixed in one column",
    "text": "5.1 Multiple types mixed in one column\nTablecloth will handle it just fine, it will just give the column the type :object\n\n(def mixed-types\n  (tc/dataset {:A [\"string\" \"more strings\" 3]\n               :B [1 2 \"whoops\"]}))\n\n\n(tc/info mixed-types :columns)\n\n\n\n\n\n\n_unnamed :column info [2 4]:\n\n\n\n\n\n\n:categorical?\n\n\n:name\n\n\n:datatype\n\n\n:n-elems\n\n\n\n\n\n\ntrue\n\n\n:A\n\n\n:object\n\n\n3\n\n\n\n\ntrue\n\n\n:B\n\n\n:object\n\n\n3\n\n\n\n\n\n\n\n\n\nTo convert all values in a row to a given type:\n\n(tc/convert-types mixed-types :A :string)\n\n\n\n\n\n\n_unnamed [3 2]:\n\n\n\n\n\n\n:A\n\n\n:B\n\n\n\n\n\n\nstring\n\n\n1\n\n\n\n\nmore strings\n\n\n2\n\n\n\n\n3\n\n\nwhoops\n\n\n\n\n\n\n\n\n\n\n(-> mixed-types\n    (tc/convert-types :A :string)\n    (tc/info :columns))\n\n\n\n\n\n\n_unnamed :column info [2 4]:\n\n\n\n\n\n\n:categorical?\n\n\n:name\n\n\n:datatype\n\n\n:n-elems\n\n\n\n\n\n\ntrue\n\n\n:A\n\n\n:string\n\n\n3\n\n\n\n\ntrue\n\n\n:B\n\n\n:object\n\n\n3\n\n\n\n\n\n\n\n\n\nIf you try to convert to something that can’t be cast under the hood, it will throw an exception: e.g. (this will make your notebook fail to render) (tc/convert-types mixed-types :B :int)"
  },
  {
    "objectID": "chapter_2_input_output/2_2_messy_data.html#multiple-formats-for-a-thing-thats-supposed-to-have-one-e.g.-phone-numbers-postal-codes",
    "href": "chapter_2_input_output/2_2_messy_data.html#multiple-formats-for-a-thing-thats-supposed-to-have-one-e.g.-phone-numbers-postal-codes",
    "title": "5  Dealing with messy data",
    "section": "5.2 Multiple formats for a thing that’s supposed to have one (e.g. phone numbers, postal codes)",
    "text": "5.2 Multiple formats for a thing that’s supposed to have one (e.g. phone numbers, postal codes)\nYou can pass any arbitrary function to update a column\n\n(def misformatted\n  (tc/dataset {:phone [\"123-456-5654\" \"(304) 342 1235\" \"(423)-234-2342\" \"1234325984\" \"nope\"]\n               :postal-code [\"t1n 0k2\" \"H9Q1L2\" \"H3H 8V0\" \"eu5h04\" \"just wrong\"]}))\n\n\n(require '[clojure.string :as str])\n\n\nnil\n\n\n(def phone-regex\n  (re-pattern\n   (str\n    \".*\"        ; zero or more of any character\n    \"(\\\\d{3})\"  ; any 3 numbers\n    \".*\"        ; zero or more of any character\n    \"(\\\\d{3})\"  ; any 3 numbers\n    \".*\"        ; zero or more of any character\n    \"(\\\\d{4})\"  ; any 4 numbers\n    )))\n\n\n(defn- normalize-phone-numbers [col]\n  (map (fn [v]\n         (let [[match a b c] (re-matches phone-regex v)]\n           (if match\n             (str \"(\" a \")-\" b \"-\" c)\n             \"INVALID\")))\n       col))\n\n\n#'chapter-2-input-output.2-2-messy-data/normalize-phone-numbers\n\n\n(def postal-code-regex\n  (re-pattern\n   (str\n    \"([A-Z]{1})\"  ; any letter\n    \".*\"          ; zero or more of any character\n    \"(\\\\d{1})\"    ; any number\n    \".*\"\n    \"([A-Z]{1})\"\n    \".*\"\n    \"(\\\\d{1})\"\n    \".*\"\n    \"([A-Z]{1})\"\n    \".*\"\n    \"(\\\\d{1})\")))\n\n\n(defn- normalize-postal-codes [col]\n  (map (fn [v]\n         (let [[match a b c d e f] (->> v str/upper-case (re-matches postal-code-regex))]\n           (if match\n             (str a b c \" \" d e f)\n             \"INVALID\")))\n       col))\n\n\n#'chapter-2-input-output.2-2-messy-data/normalize-postal-codes\n\n\n(-> misformatted\n    (tc/update-columns {:phone normalize-phone-numbers\n                        :postal-code normalize-postal-codes}))\n\n\n\n\n\n\n_unnamed [5 2]:\n\n\n\n\n\n\n:phone\n\n\n:postal-code\n\n\n\n\n\n\n(123)-456-5654\n\n\nT1N 0K2\n\n\n\n\n(304)-342-1235\n\n\nH9Q 1L2\n\n\n\n\n(423)-234-2342\n\n\nH3H 8V0\n\n\n\n\n(123)-432-5984\n\n\nINVALID\n\n\n\n\nINVALID\n\n\nINVALID"
  },
  {
    "objectID": "chapter_2_input_output/2_2_messy_data.html#missing-values",
    "href": "chapter_2_input_output/2_2_messy_data.html#missing-values",
    "title": "5  Dealing with messy data",
    "section": "5.3 Missing values",
    "text": "5.3 Missing values\nTablecloth has many built-in helpers for dealing with missing values. (require ’[tech.v3.datatype.datetime :as dt])\n\n(def sparse\n  (tc/dataset {:A [1 2 3 nil nil 6]\n               :B [\"test\" nil \"this\" \"is\" \"a\" \"test\"]}))\n\nDrop whole rows with any missing values:\n\n(tc/drop-missing sparse)\n\n\n\n\n\n\n_unnamed [3 2]:\n\n\n\n\n\n\n:A\n\n\n:B\n\n\n\n\n\n\n1\n\n\ntest\n\n\n\n\n3\n\n\nthis\n\n\n\n\n6\n\n\ntest\n\n\n\n\n\n\n\n\n\nDrop whole row with any missing values in a given column:\n\n(tc/drop-missing sparse :A)\n\n\n\n\n\n\n_unnamed [4 2]:\n\n\n\n\n\n\n:A\n\n\n:B\n\n\n\n\n\n\n1\n\n\ntest\n\n\n\n\n2\n\n\n\n\n\n\n3\n\n\nthis\n\n\n\n\n6\n\n\ntest\n\n\n\n\n\n\n\n\n\nReplace missing values Table cloth includes many strategies for replacing missing values https://scicloj.github.io/tablecloth/index.html#replace"
  },
  {
    "objectID": "chapter_2_input_output/2_2_messy_data.html#arbitrary-values-meant-to-indicate-missing-e.g.-none-na-false-etc.",
    "href": "chapter_2_input_output/2_2_messy_data.html#arbitrary-values-meant-to-indicate-missing-e.g.-none-na-false-etc.",
    "title": "5  Dealing with messy data",
    "section": "5.4 Arbitrary values meant to indicate missing (e.g. “NONE”, “N/A”, false, etc.)",
    "text": "5.4 Arbitrary values meant to indicate missing (e.g. “NONE”, “N/A”, false, etc.)\nIt’s not uncommon to see missing values indicated in multiple different ways, sometimes even within the same dataset. E.g. missing cells might be blank entirely, or they might be populated with some arbitrary value meant to indicate “nothing”, like “NONE”, “N/A”, false, etc.\n\n\n\n\nsource: book/chapter_2_input_output/2_2_messy_data.clj"
  },
  {
    "objectID": "chapter_2_input_output/2_3_exporting_data.html#writing-to-a-csv-file",
    "href": "chapter_2_input_output/2_3_exporting_data.html#writing-to-a-csv-file",
    "title": "6  How to get data out of a notebook",
    "section": "6.1 Writing to a CSV file",
    "text": "6.1 Writing to a CSV file\ndepends what the data looks like for a seq of maps: headers are not necessarily sorted, put them in whatever order you want here Clojure maps make no guarantees about key order, make sure to order values, i.e. use the same header row to get the values from each map\n\n(let [headers (-> data first keys sort)\n      rows (->> data (map (fn [row]\n                            (map (fn [header]\n                                   (get row header)) headers))))]\n  (with-open [writer (io/writer \"data/csv-output.csv\")]\n    (csv/write-csv writer (cons headers rows))))\n\n\nnil\n\nTablecloth can also export csvs (among other formats)\n\n(def tc-dataset (tc/dataset data))\n\n\n(tc/write-csv! tc-dataset \"data/tc-output.csv\")\n\n\n21"
  },
  {
    "objectID": "chapter_2_input_output/2_3_exporting_data.html#writing-nippy",
    "href": "chapter_2_input_output/2_3_exporting_data.html#writing-nippy",
    "title": "6  How to get data out of a notebook",
    "section": "6.2 Writing nippy",
    "text": "6.2 Writing nippy\n\n(tc/write! tc-dataset \"data/tc-nippy.nippy\")\n\n\nnil\n\nRead this also with tablecloth:\n\n(tc/dataset \"data/tc-nippy.nippy\")\n\n\n\n\n\n\ndata/tc-nippy.nippy [20 10]:\n\n\n\n\n\n\n0\n\n\n7\n\n\n1\n\n\n4\n\n\n6\n\n\n3\n\n\n2\n\n\n9\n\n\n5\n\n\n8\n\n\n\n\n\n\ncell-0\n\n\ncell-7\n\n\ncell-1\n\n\ncell-4\n\n\ncell-6\n\n\ncell-3\n\n\ncell-2\n\n\ncell-9\n\n\ncell-5\n\n\ncell-8\n\n\n\n\ncell-0\n\n\ncell-7\n\n\ncell-1\n\n\ncell-4\n\n\ncell-6\n\n\ncell-3\n\n\ncell-2\n\n\ncell-9\n\n\ncell-5\n\n\ncell-8\n\n\n\n\ncell-0\n\n\ncell-7\n\n\ncell-1\n\n\ncell-4\n\n\ncell-6\n\n\ncell-3\n\n\ncell-2\n\n\ncell-9\n\n\ncell-5\n\n\ncell-8\n\n\n\n\ncell-0\n\n\ncell-7\n\n\ncell-1\n\n\ncell-4\n\n\ncell-6\n\n\ncell-3\n\n\ncell-2\n\n\ncell-9\n\n\ncell-5\n\n\ncell-8\n\n\n\n\ncell-0\n\n\ncell-7\n\n\ncell-1\n\n\ncell-4\n\n\ncell-6\n\n\ncell-3\n\n\ncell-2\n\n\ncell-9\n\n\ncell-5\n\n\ncell-8\n\n\n\n\ncell-0\n\n\ncell-7\n\n\ncell-1\n\n\ncell-4\n\n\ncell-6\n\n\ncell-3\n\n\ncell-2\n\n\ncell-9\n\n\ncell-5\n\n\ncell-8\n\n\n\n\ncell-0\n\n\ncell-7\n\n\ncell-1\n\n\ncell-4\n\n\ncell-6\n\n\ncell-3\n\n\ncell-2\n\n\ncell-9\n\n\ncell-5\n\n\ncell-8\n\n\n\n\ncell-0\n\n\ncell-7\n\n\ncell-1\n\n\ncell-4\n\n\ncell-6\n\n\ncell-3\n\n\ncell-2\n\n\ncell-9\n\n\ncell-5\n\n\ncell-8\n\n\n\n\ncell-0\n\n\ncell-7\n\n\ncell-1\n\n\ncell-4\n\n\ncell-6\n\n\ncell-3\n\n\ncell-2\n\n\ncell-9\n\n\ncell-5\n\n\ncell-8\n\n\n\n\ncell-0\n\n\ncell-7\n\n\ncell-1\n\n\ncell-4\n\n\ncell-6\n\n\ncell-3\n\n\ncell-2\n\n\ncell-9\n\n\ncell-5\n\n\ncell-8\n\n\n\n\ncell-0\n\n\ncell-7\n\n\ncell-1\n\n\ncell-4\n\n\ncell-6\n\n\ncell-3\n\n\ncell-2\n\n\ncell-9\n\n\ncell-5\n\n\ncell-8\n\n\n\n\ncell-0\n\n\ncell-7\n\n\ncell-1\n\n\ncell-4\n\n\ncell-6\n\n\ncell-3\n\n\ncell-2\n\n\ncell-9\n\n\ncell-5\n\n\ncell-8\n\n\n\n\ncell-0\n\n\ncell-7\n\n\ncell-1\n\n\ncell-4\n\n\ncell-6\n\n\ncell-3\n\n\ncell-2\n\n\ncell-9\n\n\ncell-5\n\n\ncell-8\n\n\n\n\ncell-0\n\n\ncell-7\n\n\ncell-1\n\n\ncell-4\n\n\ncell-6\n\n\ncell-3\n\n\ncell-2\n\n\ncell-9\n\n\ncell-5\n\n\ncell-8\n\n\n\n\ncell-0\n\n\ncell-7\n\n\ncell-1\n\n\ncell-4\n\n\ncell-6\n\n\ncell-3\n\n\ncell-2\n\n\ncell-9\n\n\ncell-5\n\n\ncell-8\n\n\n\n\ncell-0\n\n\ncell-7\n\n\ncell-1\n\n\ncell-4\n\n\ncell-6\n\n\ncell-3\n\n\ncell-2\n\n\ncell-9\n\n\ncell-5\n\n\ncell-8\n\n\n\n\ncell-0\n\n\ncell-7\n\n\ncell-1\n\n\ncell-4\n\n\ncell-6\n\n\ncell-3\n\n\ncell-2\n\n\ncell-9\n\n\ncell-5\n\n\ncell-8\n\n\n\n\ncell-0\n\n\ncell-7\n\n\ncell-1\n\n\ncell-4\n\n\ncell-6\n\n\ncell-3\n\n\ncell-2\n\n\ncell-9\n\n\ncell-5\n\n\ncell-8\n\n\n\n\ncell-0\n\n\ncell-7\n\n\ncell-1\n\n\ncell-4\n\n\ncell-6\n\n\ncell-3\n\n\ncell-2\n\n\ncell-9\n\n\ncell-5\n\n\ncell-8\n\n\n\n\ncell-0\n\n\ncell-7\n\n\ncell-1\n\n\ncell-4\n\n\ncell-6\n\n\ncell-3\n\n\ncell-2\n\n\ncell-9\n\n\ncell-5\n\n\ncell-8"
  },
  {
    "objectID": "chapter_2_input_output/2_3_exporting_data.html#leave-data-in-clojure-files",
    "href": "chapter_2_input_output/2_3_exporting_data.html#leave-data-in-clojure-files",
    "title": "6  How to get data out of a notebook",
    "section": "6.3 Leave data in Clojure files",
    "text": "6.3 Leave data in Clojure files\n\n(->> data pr-str (spit \"data/clojure-output.edn\"))\n\n\nnil\n\nThis can be consumed later with:\n\n(with-open [reader (io/reader \"data/clojure-output.edn\")]\n  (edn/read (java.io.PushbackReader. reader)))\n\n\n({0 \"cell-0\",\n  7 \"cell-7\",\n  1 \"cell-1\",\n  4 \"cell-4\",\n  6 \"cell-6\",\n  3 \"cell-3\",\n  2 \"cell-2\",\n  9 \"cell-9\",\n  5 \"cell-5\",\n  8 \"cell-8\"}\n {0 \"cell-0\",\n  7 \"cell-7\",\n  1 \"cell-1\",\n  4 \"cell-4\",\n  6 \"cell-6\",\n  3 \"cell-3\",\n  2 \"cell-2\",\n  9 \"cell-9\",\n  5 \"cell-5\",\n  8 \"cell-8\"}\n {0 \"cell-0\",\n  7 \"cell-7\",\n  1 \"cell-1\",\n  4 \"cell-4\",\n  6 \"cell-6\",\n  3 \"cell-3\",\n  2 \"cell-2\",\n  9 \"cell-9\",\n  5 \"cell-5\",\n  8 \"cell-8\"}\n {0 \"cell-0\",\n  7 \"cell-7\",\n  1 \"cell-1\",\n  4 \"cell-4\",\n  6 \"cell-6\",\n  3 \"cell-3\",\n  2 \"cell-2\",\n  9 \"cell-9\",\n  5 \"cell-5\",\n  8 \"cell-8\"}\n {0 \"cell-0\",\n  7 \"cell-7\",\n  1 \"cell-1\",\n  4 \"cell-4\",\n  6 \"cell-6\",\n  3 \"cell-3\",\n  2 \"cell-2\",\n  9 \"cell-9\",\n  5 \"cell-5\",\n  8 \"cell-8\"}\n {0 \"cell-0\",\n  7 \"cell-7\",\n  1 \"cell-1\",\n  4 \"cell-4\",\n  6 \"cell-6\",\n  3 \"cell-3\",\n  2 \"cell-2\",\n  9 \"cell-9\",\n  5 \"cell-5\",\n  8 \"cell-8\"}\n {0 \"cell-0\",\n  7 \"cell-7\",\n  1 \"cell-1\",\n  4 \"cell-4\",\n  6 \"cell-6\",\n  3 \"cell-3\",\n  2 \"cell-2\",\n  9 \"cell-9\",\n  5 \"cell-5\",\n  8 \"cell-8\"}\n {0 \"cell-0\",\n  7 \"cell-7\",\n  1 \"cell-1\",\n  4 \"cell-4\",\n  6 \"cell-6\",\n  3 \"cell-3\",\n  2 \"cell-2\",\n  9 \"cell-9\",\n  5 \"cell-5\",\n  8 \"cell-8\"}\n {0 \"cell-0\",\n  7 \"cell-7\",\n  1 \"cell-1\",\n  4 \"cell-4\",\n  6 \"cell-6\",\n  3 \"cell-3\",\n  2 \"cell-2\",\n  9 \"cell-9\",\n  5 \"cell-5\",\n  8 \"cell-8\"}\n {0 \"cell-0\",\n  7 \"cell-7\",\n  1 \"cell-1\",\n  4 \"cell-4\",\n  6 \"cell-6\",\n  3 \"cell-3\",\n  2 \"cell-2\",\n  9 \"cell-9\",\n  5 \"cell-5\",\n  8 \"cell-8\"}\n {0 \"cell-0\",\n  7 \"cell-7\",\n  1 \"cell-1\",\n  4 \"cell-4\",\n  6 \"cell-6\",\n  3 \"cell-3\",\n  2 \"cell-2\",\n  9 \"cell-9\",\n  5 \"cell-5\",\n  8 \"cell-8\"}\n {0 \"cell-0\",\n  7 \"cell-7\",\n  1 \"cell-1\",\n  4 \"cell-4\",\n  6 \"cell-6\",\n  3 \"cell-3\",\n  2 \"cell-2\",\n  9 \"cell-9\",\n  5 \"cell-5\",\n  8 \"cell-8\"}\n {0 \"cell-0\",\n  7 \"cell-7\",\n  1 \"cell-1\",\n  4 \"cell-4\",\n  6 \"cell-6\",\n  3 \"cell-3\",\n  2 \"cell-2\",\n  9 \"cell-9\",\n  5 \"cell-5\",\n  8 \"cell-8\"}\n {0 \"cell-0\",\n  7 \"cell-7\",\n  1 \"cell-1\",\n  4 \"cell-4\",\n  6 \"cell-6\",\n  3 \"cell-3\",\n  2 \"cell-2\",\n  9 \"cell-9\",\n  5 \"cell-5\",\n  8 \"cell-8\"}\n {0 \"cell-0\",\n  7 \"cell-7\",\n  1 \"cell-1\",\n  4 \"cell-4\",\n  6 \"cell-6\",\n  3 \"cell-3\",\n  2 \"cell-2\",\n  9 \"cell-9\",\n  5 \"cell-5\",\n  8 \"cell-8\"}\n {0 \"cell-0\",\n  7 \"cell-7\",\n  1 \"cell-1\",\n  4 \"cell-4\",\n  6 \"cell-6\",\n  3 \"cell-3\",\n  2 \"cell-2\",\n  9 \"cell-9\",\n  5 \"cell-5\",\n  8 \"cell-8\"}\n {0 \"cell-0\",\n  7 \"cell-7\",\n  1 \"cell-1\",\n  4 \"cell-4\",\n  6 \"cell-6\",\n  3 \"cell-3\",\n  2 \"cell-2\",\n  9 \"cell-9\",\n  5 \"cell-5\",\n  8 \"cell-8\"}\n {0 \"cell-0\",\n  7 \"cell-7\",\n  1 \"cell-1\",\n  4 \"cell-4\",\n  6 \"cell-6\",\n  3 \"cell-3\",\n  2 \"cell-2\",\n  9 \"cell-9\",\n  5 \"cell-5\",\n  8 \"cell-8\"}\n {0 \"cell-0\",\n  7 \"cell-7\",\n  1 \"cell-1\",\n  4 \"cell-4\",\n  6 \"cell-6\",\n  3 \"cell-3\",\n  2 \"cell-2\",\n  9 \"cell-9\",\n  5 \"cell-5\",\n  8 \"cell-8\"}\n {0 \"cell-0\",\n  7 \"cell-7\",\n  1 \"cell-1\",\n  4 \"cell-4\",\n  6 \"cell-6\",\n  3 \"cell-3\",\n  2 \"cell-2\",\n  9 \"cell-9\",\n  5 \"cell-5\",\n  8 \"cell-8\"})"
  },
  {
    "objectID": "chapter_2_input_output/2_3_exporting_data.html#notebook-artifacts",
    "href": "chapter_2_input_output/2_3_exporting_data.html#notebook-artifacts",
    "title": "6  How to get data out of a notebook",
    "section": "6.4 Notebook artifacts",
    "text": "6.4 Notebook artifacts\nClerk supports publishing your namespaces as HTML (like this website!) To do that call\n\n(comment\n  (clerk/build! {:paths \"path/to/files...\"\n                 :index \"book/index.clj\"}))\n\nMore information in Clerk’s docs: https://book.clerk.vision/#static-building HTML pages Other formats, options for exporting notebooks? PDFs? Partial artifacts, e.g. export just a graph Writing to a database?\n\n\n\n\nsource: book/chapter_2_input_output/2_3_exporting_data.clj"
  },
  {
    "objectID": "scicloj/clay/v2/tool/scittle/page.html",
    "href": "scicloj/clay/v2/tool/scittle/page.html",
    "title": "book",
    "section": "",
    "text": "clojure.lang.LazySeq@78d9168a\n\n(ns scicloj.clay.v2.tool.scittle.page\n  (:require [clojure.java.io :as io]\n            [clojure.string :as string]\n            [hiccup.core :as hiccup]\n            [hiccup.page]\n            [scicloj.clay.v2.tool.scittle.cljs-generation :as cljs-generation]\n            [scicloj.clay.v2.tool.scittle.widget :as widget]\n            [scicloj.clay.v2.tool.scittle.styles :as styles]\n            [scicloj.clay.v2.util.resource :as resource]\n            [scicloj.clay.v2.html.table :as table]\n            [clj-yaml.core :as yaml]\n            [scicloj.clay.v2.tool.scittle.portal :as portal]))\n\n\n(def special-libs-set\n  #{'datatables 'vega 'echarts 'cytoscape 'plotly 'katex\n    'three-d-mol 'three-d-mol-viewer 'leaflet})\n\n\n(def special-lib-resources\n  {'vega {:js {:from-local-copy\n               [\"https://cdn.jsdelivr.net/npm/vega@5.22.1\"\n                \"https://cdn.jsdelivr.net/npm/vega-lite@5.6.0\"\n                \"https://cdn.jsdelivr.net/npm/vega-embed@6.21.0\"]}}\n   'datatables {:js {:from-the-web\n                     [\"https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js\"]}\n                :css {:from-the-web\n                      [\"https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css\"]}}\n   'echarts {:js {:from-local-copy\n                  [\"https://cdn.jsdelivr.net/npm/echarts@5.4.1/dist/echarts.min.js\"]}}\n   'cytoscape {:js {:from-local-copy\n                    [\"https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.23.0/cytoscape.min.js\"]}}\n   'plotly {:js {:from-local-copy\n                 [\"https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.20.0/plotly.min.js\"]}}\n   'katex {:js {:from-local-copy\n                [\"https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js\"]}\n           :css {:from-the-web\n                 ;; fetching the KaTeX css from the web\n                 ;; to avoid fetching the fonts locally,\n                 ;; which would need a bit more care\n                 ;; (see https://katex.org/docs/font.html)\n                 [\"https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css\"]}}\n   'three-d-mol {:js {:from-local-copy\n                      [\"https://cdnjs.cloudflare.com/ajax/libs/3Dmol/1.5.3/3Dmol.min.js\"]}}\n   'three-d-mol-viewer {:js {:from-local-copy\n                             [\"https://cdnjs.cloudflare.com/ajax/libs/3Dmol/1.5.3/3Dmol.min.js\"]}}\n   'leaflet {:js {:from-local-copy\n                  [\"https://unpkg.com/leaflet@1.9.4/dist/leaflet.js\"]}\n             :css {:from-local-copy\n                   [\"https://unpkg.com/leaflet@1.9.4/dist/leaflet.css\"]}}})\n\n\n(defn js-from-local-copies [& urls]\n  (->> urls\n       (map resource/get)\n       (map (partial vector :script {:type \"text/javascript\"}))\n       (into [:div])))\n\n\n(defn css-from-local-copies [& urls]\n  (->> urls\n       (map resource/get)\n       (map (partial vector :style))\n       (into [:div])))\n\n\n(defn special-libs-in-form [f]\n  (->> f\n       (tree-seq (fn [x]\n                   (or (vector? x)\n                       (map? x)\n                       (list? x)\n                       (seq? x)))\n                 (fn [x]\n                   (if (map? x)\n                     (vals x)\n                     x)))\n       (filter special-libs-set)\n       distinct\n       set))\n\n\n(defn page [{:keys [widgets data port title toc? counter]}]\n  (let [special-libs (->> widgets\n                          special-libs-in-form)]\n    (when-not port\n      (throw (ex-info \"missing port\" {})))\n    (-> (hiccup.page/html5 [:head\n                            [:meta {:charset \"UTF-8\"}]\n                            [:meta {:name \"viewport\" :content \"width=device-width, initial-scale=1\"}]\n                            [:link {:rel \"shortcut icon\" :href \"data:,\"}]\n                            [:link {:rel \"apple-touch-icon\" :href \"data:,\"}]\n                            ;; [:link {:rel \"stylesheet\" :href \"https://cdn.jsdelivr.net/npm/bulma@0.9.0/css/bulma.min.css\"}]\n                            \"\n    <link rel=\\\"preconnect\\\" href=\\\"https://fonts.googleapis.com\\\">\n    <link rel=\\\"preconnect\\\" href=\\\"https://fonts.gstatic.com\\\" crossorigin>\n    <link href=\\\"https://fonts.googleapis.com/css2?family=Roboto&display=swap\\\" rel=\\\"stylesheet\\\">\n\"\n                            [:style styles/table]\n                            [:style styles/loader]\n                            [:style\n                             (-> #_\"highlight/styles/tokyo-night-light.min.css\"\n                                 #_\"highlight/styles/stackoverflow-light.min.css\"\n                                 \"highlight/styles/qtcreator-light.min.css\"\n                                 #_\"highlight/styles/nord.min.css\"\n                                 io/resource\n                                 slurp)]\n                            (css-from-local-copies \"https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css\")\n                            [:style \"\ncode {\n  font-family: Fira Code,monospace,Consolas,courier new;\n  color: black;\n  background-color: #f0f0f0;\n  padding: 2px;\n  .bg-light;\n}\"]\n\n                            (when toc?\n                              (css-from-local-copies\n                               #_\"https://cdn.jsdelivr.net/npm/bootswatch@4.5.2/dist/sandstone/bootstrap.min.css\"\n                               #_\"https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css\"\n                               \"https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.css\"))\n                            (when toc?\n                              [:style styles/boostrap-toc])\n                            (->> special-libs\n                                 (mapcat (comp :from-local-copy :css special-lib-resources))\n                                 distinct\n                                 (apply css-from-local-copies))\n                            (->> special-libs\n                                 (mapcat (comp :from-the-web :css special-lib-resources))\n                                 distinct\n                                 (apply hiccup.page/include-css))\n                            [:title (or title \"Clay\")]]\n                           [:body  {:style {:background \"#fcfcfc\"\n                                            :font-family \"'Roboto', sans-serif\"\n                                            :width \"90%\"\n                                            :margin \"auto\"}\n                                    :data-spy \"scroll\"\n                                    :data-target \"#toc\"}\n\n                            (js-from-local-copies \"https://code.jquery.com/jquery-3.6.0.min.js\"\n                                                  \"https://code.jquery.com/ui/1.13.1/jquery-ui.min.js\"\n                                                  \"https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js\")\n                            (when toc?\n                              (js-from-local-copies\n                               \"https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js\"))\n                            (js-from-local-copies\n                             \"https://unpkg.com/react@18/umd/react.production.min.js\"\n                             \"https://unpkg.com/react-dom@18/umd/react-dom.production.min.js\"\n                             \"https://scicloj.github.io/scittle/js/scittle.js\"\n                             \"https://scicloj.github.io/scittle/js/scittle.cljs-ajax.js\"\n                             \"https://scicloj.github.io/scittle/js/scittle.reagent.js\"\n                             \"https://scicloj.github.io/scittle/js/scittle.mathbox.js\"\n                             \"https://scicloj.github.io/scittle/js/scittle.emmy.js\"\n                             \"https://scicloj.github.io/scittle/js/scittle.tmdjs.js\")\n                            [:script {:type \"text/javascript\"}\n                             (-> \"highlight/highlight.min.js\"\n                                 io/resource\n                                 slurp)]\n                            (hiccup.page/include-js portal/url)\n                            (->> special-libs\n                                 (mapcat (comp :from-local-copy :js special-lib-resources))\n                                 distinct\n                                 (apply js-from-local-copies))\n                            (->> special-libs\n                                 (mapcat (comp :from-the-web :js special-lib-resources))\n                                 distinct\n                                 (apply hiccup.page/include-js))\n                            [:div.container\n                             [:div.row\n                              (when toc?\n                                [:div.col-sm-3\n                                 [:nav.sticky-top {:id \"toc\"\n                                                   :data-toggle \"toc\"}]])\n                              [:div {:class (if toc?\n                                              \"col-sm-9\"\n                                              \"col-sm-12\")}\n                               [:div\n                                [:div\n                                 (->> widgets\n                                      (map-indexed\n                                       (fn [i widget]\n                                         [:div {:style {:margin \"15px\"}}\n                                          (cond\n                                            (-> widget meta :clay/hide-code?)\n                                            nil\n                                            ;;\n                                            (widget/check widget :clay/plain-html?)\n                                            widget\n                                            ;; widget\n                                            ;;\n                                            :else\n                                            [:div {:id (str \"widget\" i)}\n                                             [:code \"loading ...\"]])]))\n                                      (into [:div]))]]]]]\n                            [:script {:type \"text/javascript\"}\n                             \"hljs.highlightAll();\"]\n                            [:script {:type \"application/x-scittle\"}\n                             (->> {:widgets widgets\n                                   :data data\n                                   :port port\n                                   :special-libs special-libs\n                                   :server-counter counter}\n                                  cljs-generation/widgets-cljs\n                                  (map pr-str)\n                                  (string/join \"\\n\"))]])\n        (string/replace #\"<table>\"\n                        \"<table class='table table-hover'>\"))))\n\n\n(defn qmd [{:keys [data port title options counter]}\n           widgets]\n  (let [special-libs (->> widgets\n                          special-libs-in-form)]\n    (when-not port\n      (throw (ex-info \"missing port\" {})))\n    (str\n     (->> options\n          :quarto\n          yaml/generate-string\n          (format \"\\n---\\n%s\\n---\\n\"))\n\n     \"\n\"\n     (-> (str (hiccup/html\n               [:div\n                [:style styles/table]\n                [:style styles/loader]\n                [:style \"\n.printedClojure .sourceCode {\n  background-color: transparent;\n  border-style: none;\n}\n\"]\n                (hiccup.page/include-js portal/url)\n                (->> special-libs\n                     (mapcat (comp :from-local-copy :css special-lib-resources))\n                     distinct\n                     (apply css-from-local-copies))\n                (->> special-libs\n                     (mapcat (comp :from-the-web :css special-lib-resources))\n                     distinct\n                     (apply hiccup.page/include-css))])\n              (hiccup/html\n               [:div\n                (js-from-local-copies \"https://code.jquery.com/jquery-3.6.0.min.js\"\n                                      \"https://code.jquery.com/ui/1.13.1/jquery-ui.min.js\"\n                                      #_\"https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js\")\n                (js-from-local-copies\n                 \"https://unpkg.com/react@17/umd/react.production.min.js\"\n                 \"https://unpkg.com/react-dom@17/umd/react-dom.production.min.js\"\n                 \"https://scicloj.github.io/scittle/js/scittle.js\"\n                 \"https://scicloj.github.io/scittle/js/scittle.cljs-ajax.js\"\n                 \"https://scicloj.github.io/scittle/js/scittle.reagent.js\"\n                 \"https://scicloj.github.io/scittle/js/scittle.mathbox.js\"\n                 \"https://scicloj.github.io/scittle/js/scittle.emmy.js\"\n                 \"https://scicloj.github.io/scittle/js/scittle.tmdjs.js\")\n                (->> special-libs\n                     (mapcat (comp :from-local-copy :js special-lib-resources))\n                     distinct\n                     (apply js-from-local-copies))\n                (->> special-libs\n                     (mapcat (comp :from-the-web :js special-lib-resources))\n                     distinct\n                     (apply hiccup.page/include-js))\n                (->> widgets\n                     (map-indexed\n                      (fn [i widget]\n                        (cond\n                          ;;\n                          (-> widget\n                              meta\n                              :clay/original-markdown)\n                          (-> widget\n                              meta\n                              :clay/original-markdown)\n                          ;;\n                          (-> widget\n                              meta\n                              :clay/original-code)\n                          (let [code (if (-> widget\n                                             meta\n                                             :clay/hide-code?)\n                                       \"\"\n                                       (-> widget\n                                           meta\n                                           :clay/original-code))]\n                            (if (= code \"\")\n                              \"\n\"\n                              (->> code\n                                   (format \"\n<div class=\\\"originalCode\\\">\n```clojure\n%s\n\n“)))) ;; ;; (widget/check widget :clay/printed-clojure?) (->> widget meta :clay/text (format”\n\n%s\n\n“)) ;; (widget/check widget :clay/plain-html?) (hiccup/html widget) ;; :else (hiccup/html [:div {:id (str ”widget” i)} [:code ”loading …”]])))) (string/join”“)) [:script {:type ”application/x-scittle”} (->> {:widgets widgets :data data :port port :special-libs special-libs :server-counter counter} cljs-generation/widgets-cljs (map pr-str) (string/join ””))]])) (string/replace #”\n\n\n” “\n\n“)))))</div>\n\n\n\n<div class=\"originalCode\">\n```clojure\n(defn signals-of-no-plain-html? [hiccup]\n  (or (->> hiccup\n           special-libs-in-form\n           (some (partial not= 'vega)))\n      (->> hiccup\n           flatten\n           (some #{'fn 'quote}))))\n(defn light-qmd [{:keys [data title options counter]}\n                 widgets]\n  (let [special-libs (->> widgets\n                          special-libs-in-form)]\n    (str\n     (->> options\n          :quarto\n          yaml/generate-string\n          (format \"\\n---\\n%s\\n---\\n\"))\n\n     ;; \" \"\n     (hiccup/html\n      [:style styles/table]\n      [:style \"\n.printedClojure .sourceCode {\n  background-color: transparent;\n  border-style: none;\n}\n\"])\n     (hiccup.page/include-js portal/url)\n     (when (special-libs 'vega)\n       (->> 'vega\n            special-lib-resources\n            :js\n            :from-local-copy\n            (apply hiccup.page/include-js)\n            hiccup/html))\n     (->> widgets\n          (map-indexed\n           (fn [i widget]\n             (cond\n               ;;\n               (-> widget\n                   meta\n                   :clay/original-markdown)\n               (-> widget\n                   meta\n                   :clay/original-markdown)\n               ;;\n               (-> widget\n                   meta\n                   :clay/original-code)\n               (let [code (if (-> widget\n                                  meta\n                                  :clay/hide-code?)\n                            \"\"\n                            (-> widget\n                                meta\n                                :clay/original-code))]\n                 (if (= code \"\")\n                   \"\n\"\n                   (->> code\n                        (format \"\n<div class=\\\"originalCode\\\">\n```clojure\n%s\n\n“)))) ;; ;; (widget/check widget :clay/printed-clojure?) (->> widget meta :clay/text (format”\n\n%s\n\n“)) ;; (widget/check widget :clay/plain-html?) (hiccup/html widget) ;; (not (signals-of-no-plain-html? widget)) (try (hiccup/html widget) (catch Exception e” unsupported element “)) ;; :else” unsupported element “))) (string/join”“))))) ```\n\n\n\nsource: src/scicloj/clay/v2/tool/scittle/page.clj\n\n  \n      \n         3  2.3 How to get data out of a notebook\n                \n  \n  \n      \n        5  3. Data manipulation"
  },
  {
    "objectID": "chapter_3_data_manipulation/3_data_manipulation.html#sorting",
    "href": "chapter_3_data_manipulation/3_data_manipulation.html#sorting",
    "title": "7  Data manipulation",
    "section": "7.1 Sorting",
    "text": "7.1 Sorting\n\n(def dataset (tc/dataset [{:country \"Canada\"\n                           :size 10000000}\n                          {:country \"USA\"\n                           :size 9000000}\n                          {:country \"Germany\"\n                           :size 80000}]))\n\n\n7.1.1 Sorting columns\nGive the column headers in the order you want\n\n(-> dataset\n    (tc/reorder-columns [:country :size]))\n\n\n\n\n\n\n_unnamed [3 2]:\n\n\n\n\n\n\n:country\n\n\n:size\n\n\n\n\n\n\nCanada\n\n\n10000000\n\n\n\n\nUSA\n\n\n9000000\n\n\n\n\nGermany\n\n\n80000\n\n\n\n\n\n\n\n\n\n\n\n7.1.2 Sorting rows\n\n(-> dataset\n    (tc/order-by [:size] [:desc]))\n\n\n\n\n\n\n_unnamed [3 2]:\n\n\n\n\n\n\n:country\n\n\n:size\n\n\n\n\n\n\nCanada\n\n\n10000000\n\n\n\n\nUSA\n\n\n9000000\n\n\n\n\nGermany\n\n\n80000\n\n\n\n\n\n\n\n\n\n\n\n7.1.3 Custom sorting functions\ne.g. length of the country name\n\n(-> dataset\n    (tc/order-by (fn [row] (-> row :country count))\n                 :desc))\n\n\n\n\n\n\n_unnamed [3 2]:\n\n\n\n\n\n\n:country\n\n\n:size\n\n\n\n\n\n\nGermany\n\n\n80000\n\n\n\n\nCanada\n\n\n10000000\n\n\n\n\nUSA\n\n\n9000000"
  },
  {
    "objectID": "chapter_3_data_manipulation/3_data_manipulation.html#selecting-one-column-or-multiple-columns",
    "href": "chapter_3_data_manipulation/3_data_manipulation.html#selecting-one-column-or-multiple-columns",
    "title": "7  Data manipulation",
    "section": "7.2 Selecting one column or multiple columns",
    "text": "7.2 Selecting one column or multiple columns\n\n(-> dataset\n    (tc/select-columns [:country]))\n\n\n\n\n\n\n_unnamed [3 1]:\n\n\n\n\n\n\n:country\n\n\n\n\n\n\nCanada\n\n\n\n\nUSA\n\n\n\n\nGermany"
  },
  {
    "objectID": "chapter_3_data_manipulation/3_data_manipulation.html#randomizing-order",
    "href": "chapter_3_data_manipulation/3_data_manipulation.html#randomizing-order",
    "title": "7  Data manipulation",
    "section": "7.3 Randomizing order",
    "text": "7.3 Randomizing order\n\n(-> dataset tc/shuffle)\n\n\n\n\n\n\n_unnamed [3 2]:\n\n\n\n\n\n\n:country\n\n\n:size\n\n\n\n\n\n\nUSA\n\n\n9000000\n\n\n\n\nCanada\n\n\n10000000\n\n\n\n\nGermany\n\n\n80000"
  },
  {
    "objectID": "chapter_3_data_manipulation/3_data_manipulation.html#repeatable-randomisation",
    "href": "chapter_3_data_manipulation/3_data_manipulation.html#repeatable-randomisation",
    "title": "7  Data manipulation",
    "section": "7.4 Repeatable randomisation",
    "text": "7.4 Repeatable randomisation\n\n(-> dataset (tc/shuffle {:seed 100}))\n\n\n\n\n\n\n_unnamed [3 2]:\n\n\n\n\n\n\n:country\n\n\n:size\n\n\n\n\n\n\nCanada\n\n\n10000000\n\n\n\n\nGermany\n\n\n80000\n\n\n\n\nUSA\n\n\n9000000\n\n\n\n\n\n\n\n\n\nFinding unique rows\n\n(def dupes (tc/dataset [{:country \"Canada\"\n                         :size 10000000}\n                        {:country \"Canada\"\n                         :size 10000303}\n                        {:country \"United states\"\n                         :size 9000000}\n                        {:country \"United States\"\n                         :size 9000000}\n                        {:country \"Germany\"\n                         :size 80000}]))\n\n(def “USA” #{“USA” “United States” “United states of America”}) https://scicloj.github.io/tablecloth/index.html#Unique\n\n(-> dupes tc/unique-by)\n\n\n\n\n\n\n_unnamed [5 2]:\n\n\n\n\n\n\n:country\n\n\n:size\n\n\n\n\n\n\nCanada\n\n\n10000000\n\n\n\n\nCanada\n\n\n10000303\n\n\n\n\nUnited states\n\n\n9000000\n\n\n\n\nUnited States\n\n\n9000000\n\n\n\n\nGermany\n\n\n80000\n\n\n\n\n\n\n\n\n\n\n(-> dupes (tc/unique-by :size))\n\n\n\n\n\n\n_unnamed [4 2]:\n\n\n\n\n\n\n:country\n\n\n:size\n\n\n\n\n\n\nCanada\n\n\n10000000\n\n\n\n\nCanada\n\n\n10000303\n\n\n\n\nUnited states\n\n\n9000000\n\n\n\n\nGermany\n\n\n80000\n\n\n\n\n\n\n\n\n\n\n(-> dupes (tc/unique-by :country))\n\n\n\n\n\n\n_unnamed [4 2]:\n\n\n\n\n\n\n:country\n\n\n:size\n\n\n\n\n\n\nCanada\n\n\n10000000\n\n\n\n\nUnited states\n\n\n9000000\n\n\n\n\nUnited States\n\n\n9000000\n\n\n\n\nGermany\n\n\n80000\n\n\n\n\n\n\n\n\n\n\n(-> dupes (tc/unique-by #(-> % :country str/lower-case)))\n\n\n\n\n\n\n_unnamed [3 2]:\n\n\n\n\n\n\n:country\n\n\n:size\n\n\n\n\n\n\nCanada\n\n\n10000000\n\n\n\n\nUnited states\n\n\n9000000\n\n\n\n\nGermany\n\n\n80000\n\n\n\n\n\n\n\n\n\n\n(-> dupes (tc/unique-by #(-> % :country str/lower-case) {:strategy (fn [vals]\n                                                                     (case (tdsc/column-name vals)\n                                                                       :size (apply max vals)\n                                                                       :country (last vals)))}))\n\n\n\n\n\n\n_unnamed [3 2]:\n\n\n\n\n\n\n:country\n\n\n:size\n\n\n\n\n\n\nCanada\n\n\n10000303\n\n\n\n\nUnited States\n\n\n9000000\n\n\n\n\nGermany\n\n\n80000\n\n\n\n\n\n\n\n\n\ncould use this to rename vals to a canonical one (e.g. convert everything that matches set of USA to “USA”) Adding computed columns to data “lengthening” or “widening” data, making it “tidy” e.g. converting a column with numbers to a category (>5 “yes”, <5 “no”), summing multiple columns into a new one\n\n(-> dataset\n    (tc/add-column :area [9000000 8000000 1000000]))\n\n\n\n\n\n\n_unnamed [3 3]:\n\n\n\n\n\n\n:country\n\n\n:size\n\n\n:area\n\n\n\n\n\n\nCanada\n\n\n10000000\n\n\n9000000\n\n\n\n\nUSA\n\n\n9000000\n\n\n8000000\n\n\n\n\nGermany\n\n\n80000\n\n\n1000000\n\n\n\n\n\n\n\n\n\n\n(-> dataset\n    (tc/add-column :population [40000000 100000000 80000000])\n    (tc/rename-columns {:size :area})\n    (tc/convert-types :population :double)\n    (tc/add-column :density (fn [d]\n                              (fun// (:population d) (:area d)))))\n\n\n\n\n\n\n_unnamed [3 4]:\n\n\n\n\n\n\n:country\n\n\n:area\n\n\n:population\n\n\n:density\n\n\n\n\n\n\nCanada\n\n\n10000000\n\n\n4.0E+07\n\n\n4.00000000\n\n\n\n\nUSA\n\n\n9000000\n\n\n1.0E+08\n\n\n11.11111111\n\n\n\n\nGermany\n\n\n80000\n\n\n8.0E+07\n\n\n1000.00000000\n\n\n\n\n\n\n\n\n\nvs, probably preferable\n\n(-> dataset\n    (tc/add-column :population [40000000 100000000 80000000])\n    (tc/rename-columns {:size :area})\n    (tc/add-column :density (fn [ds]\n                              (fun// (fun/* 1.0 (:population ds)) (:area ds)))))\n\n\n\n\n\n\n_unnamed [3 4]:\n\n\n\n\n\n\n:country\n\n\n:area\n\n\n:population\n\n\n:density\n\n\n\n\n\n\nCanada\n\n\n10000000\n\n\n40000000\n\n\n4.00000000\n\n\n\n\nUSA\n\n\n9000000\n\n\n100000000\n\n\n11.11111111\n\n\n\n\nGermany\n\n\n80000\n\n\n80000000\n\n\n1000.00000000\n\n\n\n\n\n\n\n\n\n\nRemoving columns\n\n\n(-> dataset\n    (tc/drop-columns :size))\n\n\n\n\n\n\n_unnamed [3 1]:\n\n\n\n\n\n\n:country\n\n\n\n\n\n\nCanada\n\n\n\n\nUSA\n\n\n\n\nGermany\n\n\n\n\n\n\n\n\n\n\nTransforming values\nWorking with nested data structures, really nice libraries in Clojure for doing this (specter, meander)\nAll values in a column\nConditional transformation (e.g. “truncate only 11 digit phone numbers to 10 digits”)\nRearranging order of columns\nRenaming columns\nFiltering rows\nSingle filter, multiple filters\n\n\n(-> dataset\n    (tc/select-rows (fn [row]\n                      (< 1000000 (:size row)))))\n\n\n\n\n\n\n_unnamed [2 2]:\n\n\n\n\n\n\n:country\n\n\n:size\n\n\n\n\n\n\nCanada\n\n\n10000000\n\n\n\n\nUSA\n\n\n9000000\n\n\n\n\n\n\n\n\n\n\nAggregating rows (counts, groups)\n\n\n(def co2-over-time (tc/dataset \"data/co2_over_time.csv\"))\n\n\n(-> co2-over-time\n    (tc/aggregate {:average-co2 (fn [ds]\n                                  (/ (reduce + (get ds \"CO2\"))\n                                     (count (get ds \"CO2\"))))}))\n\n\n\n\n\n\n_unnamed [1 1]:\n\n\n\n\n\n\n:average-co2\n\n\n\n\n\n\n355.31093117\n\n\n\n\n\n\n\n\n\nAdd a column for year\n\n(-> co2-over-time\n    (tc/map-columns \"Year\" \"Date\" (memfn getYear)))\n\n\n\n\n\n\ndata/co2_over_time.csv [741 4]:\n\n\n\n\n\n\nDate\n\n\nCO2\n\n\nadjusted CO2\n\n\nYear\n\n\n\n\n\n\n1958-03-01\n\n\n315.70\n\n\n314.44\n\n\n1958\n\n\n\n\n1958-04-01\n\n\n317.46\n\n\n315.16\n\n\n1958\n\n\n\n\n1958-05-01\n\n\n317.51\n\n\n314.71\n\n\n1958\n\n\n\n\n1958-07-01\n\n\n315.86\n\n\n315.19\n\n\n1958\n\n\n\n\n1958-08-01\n\n\n314.93\n\n\n316.19\n\n\n1958\n\n\n\n\n1958-09-01\n\n\n313.21\n\n\n316.08\n\n\n1958\n\n\n\n\n1958-11-01\n\n\n313.33\n\n\n315.20\n\n\n1958\n\n\n\n\n1958-12-01\n\n\n314.67\n\n\n315.43\n\n\n1958\n\n\n\n\n1959-01-01\n\n\n315.58\n\n\n315.54\n\n\n1959\n\n\n\n\n1959-02-01\n\n\n316.49\n\n\n315.86\n\n\n1959\n\n\n\n\n…\n\n\n…\n\n\n…\n\n\n…\n\n\n\n\n2019-06-01\n\n\n413.96\n\n\n411.38\n\n\n2019\n\n\n\n\n2019-07-01\n\n\n411.85\n\n\n411.03\n\n\n2019\n\n\n\n\n2019-08-01\n\n\n410.08\n\n\n411.62\n\n\n2019\n\n\n\n\n2019-09-01\n\n\n408.55\n\n\n412.06\n\n\n2019\n\n\n\n\n2019-10-01\n\n\n408.43\n\n\n412.06\n\n\n2019\n\n\n\n\n2019-11-01\n\n\n410.29\n\n\n412.56\n\n\n2019\n\n\n\n\n2019-12-01\n\n\n411.85\n\n\n412.78\n\n\n2019\n\n\n\n\n2020-01-01\n\n\n413.37\n\n\n413.32\n\n\n2020\n\n\n\n\n2020-02-01\n\n\n414.09\n\n\n413.33\n\n\n2020\n\n\n\n\n2020-03-01\n\n\n414.51\n\n\n412.94\n\n\n2020\n\n\n\n\n2020-04-01\n\n\n416.18\n\n\n413.35\n\n\n2020\n\n\n\n\n\n\n\n\n\nGroup by year\n\n(-> co2-over-time\n    (tc/group-by (fn [row]\n                   (.getYear (get row \"Date\")))))\n\n\n\n\n\n\n_unnamed [63 3]:\n\n\n\n\n\n\n:name\n\n\n:group-id\n\n\n:data\n\n\n\n\n\n\n1958\n\n\n0\n\n\nGroup: 1958 [8 3]:\n\n\n\n\n1959\n\n\n1\n\n\nGroup: 1959 [12 3]:\n\n\n\n\n1960\n\n\n2\n\n\nGroup: 1960 [12 3]:\n\n\n\n\n1961\n\n\n3\n\n\nGroup: 1961 [12 3]:\n\n\n\n\n1962\n\n\n4\n\n\nGroup: 1962 [12 3]:\n\n\n\n\n1963\n\n\n5\n\n\nGroup: 1963 [12 3]:\n\n\n\n\n1964\n\n\n6\n\n\nGroup: 1964 [9 3]:\n\n\n\n\n1965\n\n\n7\n\n\nGroup: 1965 [12 3]:\n\n\n\n\n1966\n\n\n8\n\n\nGroup: 1966 [12 3]:\n\n\n\n\n1967\n\n\n9\n\n\nGroup: 1967 [12 3]:\n\n\n\n\n…\n\n\n…\n\n\n…\n\n\n\n\n2010\n\n\n52\n\n\nGroup: 2010 [12 3]:\n\n\n\n\n2011\n\n\n53\n\n\nGroup: 2011 [12 3]:\n\n\n\n\n2012\n\n\n54\n\n\nGroup: 2012 [12 3]:\n\n\n\n\n2013\n\n\n55\n\n\nGroup: 2013 [12 3]:\n\n\n\n\n2014\n\n\n56\n\n\nGroup: 2014 [12 3]:\n\n\n\n\n2015\n\n\n57\n\n\nGroup: 2015 [12 3]:\n\n\n\n\n2016\n\n\n58\n\n\nGroup: 2016 [12 3]:\n\n\n\n\n2017\n\n\n59\n\n\nGroup: 2017 [12 3]:\n\n\n\n\n2018\n\n\n60\n\n\nGroup: 2018 [12 3]:\n\n\n\n\n2019\n\n\n61\n\n\nGroup: 2019 [12 3]:\n\n\n\n\n2020\n\n\n62\n\n\nGroup: 2020 [4 3]:\n\n\n\n\n\n\n\n\n\nGet average temp per year tablecloth applies the aggregate fn to every groups dataset\n\n(defn round2\n  \"Round a double to the given precision (number of significant digits)\"\n  [precision d]\n  (let [factor (Math/pow 10 precision)]\n    (/ (Math/round (* d factor)) factor)))\n\n\n(-> co2-over-time\n    (tc/group-by (fn [row]\n                   (.getYear (get row \"Date\"))))\n    (tc/aggregate {:average-co2 (fn [ds]\n                                  (round2 2\n                                          (/ (reduce + (get ds \"CO2\"))\n                                             (count (get ds \"CO2\")))))}))\n\n\n\n\n\n\n_unnamed [63 2]:\n\n\n\n\n\n\n:$group-name\n\n\n:average-co2\n\n\n\n\n\n\n1958\n\n\n315.33\n\n\n\n\n1959\n\n\n315.98\n\n\n\n\n1960\n\n\n316.91\n\n\n\n\n1961\n\n\n317.65\n\n\n\n\n1962\n\n\n318.45\n\n\n\n\n1963\n\n\n318.99\n\n\n\n\n1964\n\n\n319.20\n\n\n\n\n1965\n\n\n320.04\n\n\n\n\n1966\n\n\n321.37\n\n\n\n\n1967\n\n\n322.18\n\n\n\n\n…\n\n\n…\n\n\n\n\n2010\n\n\n389.90\n\n\n\n\n2011\n\n\n391.65\n\n\n\n\n2012\n\n\n393.87\n\n\n\n\n2013\n\n\n396.57\n\n\n\n\n2014\n\n\n398.61\n\n\n\n\n2015\n\n\n400.89\n\n\n\n\n2016\n\n\n404.28\n\n\n\n\n2017\n\n\n406.58\n\n\n\n\n2018\n\n\n408.59\n\n\n\n\n2019\n\n\n411.50\n\n\n\n\n2020\n\n\n414.54\n\n\n\n\n\n\n\n\n\nCan rename the column to be more descriptive\n\n(-> co2-over-time\n    (tc/group-by (fn [row]\n                   (.getYear (get row \"Date\"))))\n    (tc/aggregate {:average-co2 (fn [ds]\n                                  (/ (reduce + (get ds \"CO2\"))\n                                     (count (get ds \"CO2\"))))})\n    (tc/rename-columns {:$group-name :year}))\n\n\n\n\n\n\n_unnamed [63 2]:\n\n\n\n\n\n\n:year\n\n\n:average-co2\n\n\n\n\n\n\n1958\n\n\n315.33375000\n\n\n\n\n1959\n\n\n315.98166667\n\n\n\n\n1960\n\n\n316.90916667\n\n\n\n\n1961\n\n\n317.64500000\n\n\n\n\n1962\n\n\n318.45416667\n\n\n\n\n1963\n\n\n318.99250000\n\n\n\n\n1964\n\n\n319.20111111\n\n\n\n\n1965\n\n\n320.03583333\n\n\n\n\n1966\n\n\n321.36916667\n\n\n\n\n1967\n\n\n322.18083333\n\n\n\n\n…\n\n\n…\n\n\n\n\n2010\n\n\n389.90083333\n\n\n\n\n2011\n\n\n391.64833333\n\n\n\n\n2012\n\n\n393.87000000\n\n\n\n\n2013\n\n\n396.56666667\n\n\n\n\n2014\n\n\n398.61416667\n\n\n\n\n2015\n\n\n400.88500000\n\n\n\n\n2016\n\n\n404.27750000\n\n\n\n\n2017\n\n\n406.58416667\n\n\n\n\n2018\n\n\n408.58750000\n\n\n\n\n2019\n\n\n411.49500000\n\n\n\n\n2020\n\n\n414.53750000\n\n\n\n\n\n\n\n\n\nConcatenating datasets\n\n(def ds1 (tc/dataset [{:id \"id1\" :b \"val1\"}\n                      {:id \"id2\" :b \"val2\"}\n                      {:id \"id3\" :b \"val3\"}]))\n\n\n(def ds2 (tc/dataset [{:id \"id1\" :b \"val4\"}\n                      {:id \"id5\" :b \"val5\"}\n                      {:id \"id6\" :b \"val6\"}]))\n\nNaively concats rows\n\n(tc/concat ds1 ds2 (tc/dataset [{:id \"id3\" :b \"other value\"}]))\n\n\n\n\n\n\n_unnamed [7 2]:\n\n\n\n\n\n\n:id\n\n\n:b\n\n\n\n\n\n\nid1\n\n\nval1\n\n\n\n\nid2\n\n\nval2\n\n\n\n\nid3\n\n\nval3\n\n\n\n\nid1\n\n\nval4\n\n\n\n\nid5\n\n\nval5\n\n\n\n\nid6\n\n\nval6\n\n\n\n\nid3\n\n\nother value\n\n\n\n\n\n\n\n\n\n\n(tc/concat ds1 (tc/dataset [{:b \"val4\" :c \"text\"}\n                            {:b \"val5\" :c \"hi\"}\n                            {:b \"val6\" :c \"test\"}]))\n\n\n\n\n\n\n_unnamed [6 3]:\n\n\n\n\n\n\n:id\n\n\n:b\n\n\n:c\n\n\n\n\n\n\nid1\n\n\nval1\n\n\n\n\n\n\nid2\n\n\nval2\n\n\n\n\n\n\nid3\n\n\nval3\n\n\n\n\n\n\n\n\nval4\n\n\ntext\n\n\n\n\n\n\nval5\n\n\nhi\n\n\n\n\n\n\nval6\n\n\ntest\n\n\n\n\n\n\n\n\n\nDe-duping\n\n(tc/union ds1 ds2)\n\n\n\n\n\n\nunion [6 2]:\n\n\n\n\n\n\n:id\n\n\n:b\n\n\n\n\n\n\nid1\n\n\nval1\n\n\n\n\nid2\n\n\nval2\n\n\n\n\nid3\n\n\nval3\n\n\n\n\nid1\n\n\nval4\n\n\n\n\nid5\n\n\nval5\n\n\n\n\nid6\n\n\nval6\n\n\n\n\n\n\n\n\n\n\nMerging datasets\nWhen column headers are the same or different, on multiple columns TODO explain set logic and SQL joins\n\n\n(def ds3 (tc/dataset {:id [1 2 3 4]\n                      :b [\"val1\" \"val2\" \"val3\" \"val4\"]}))\n\n\n(def ds4 (tc/dataset {:id [1 2 3 4]\n                      :c [\"val1\" \"val2\" \"val3\" \"val4\"]}))\n\nKeep all columns\n\n(tc/full-join ds3 ds4 :id)\n\n\n\n\n\n\nfull-join [4 4]:\n\n\n\n\n\n\n:id\n\n\n:b\n\n\n:right.id\n\n\n:c\n\n\n\n\n\n\n1\n\n\nval1\n\n\n1\n\n\nval1\n\n\n\n\n2\n\n\nval2\n\n\n2\n\n\nval2\n\n\n\n\n3\n\n\nval3\n\n\n3\n\n\nval3\n\n\n\n\n4\n\n\nval4\n\n\n4\n\n\nval4\n\n\n\n\n\n\n\n\n\n“Merge” datasets on a given column where rows have a value\n\n(tc/inner-join ds3 ds4 :id)\n\n\n\n\n\n\ninner-join [4 3]:\n\n\n\n\n\n\n:id\n\n\n:b\n\n\n:c\n\n\n\n\n\n\n1\n\n\nval1\n\n\nval1\n\n\n\n\n2\n\n\nval2\n\n\nval2\n\n\n\n\n3\n\n\nval3\n\n\nval3\n\n\n\n\n4\n\n\nval4\n\n\nval4\n\n\n\n\n\n\n\n\n\nDrop rows missing a value\n\n(tc/inner-join (tc/dataset {:id [1 2 3 4]\n                      :b [\"val1\" \"val2\" \"val3\"]})\n               (tc/dataset {:id [1 2 3 4]\n                      :c [\"val1\" \"val2\" \"val3\" \"val4\"]})\n               :id)\n\n\n\n\n\n\ninner-join [4 3]:\n\n\n\n\n\n\n:id\n\n\n:b\n\n\n:c\n\n\n\n\n\n\n1\n\n\nval1\n\n\nval1\n\n\n\n\n2\n\n\nval2\n\n\nval2\n\n\n\n\n3\n\n\nval3\n\n\nval3\n\n\n\n\n4\n\n\n\n\nval4\n\n\n\n\n\n\n\n\n\n\n(tc/right-join (tc/dataset {:id [1 2 3 ]\n                            :b [\"val1\" \"val2\" \"val3\"]})\n               (tc/dataset {:id [1 2 3 4]\n                            :c [\"val1\" \"val2\" \"val3\" \"val4\"]})\n               :id)\n\n\n\n\n\n\nright-outer-join [4 4]:\n\n\n\n\n\n\n:id\n\n\n:b\n\n\n:right.id\n\n\n:c\n\n\n\n\n\n\n1\n\n\nval1\n\n\n1\n\n\nval1\n\n\n\n\n2\n\n\nval2\n\n\n2\n\n\nval2\n\n\n\n\n3\n\n\nval3\n\n\n3\n\n\nval3\n\n\n\n\n\n\n\n\n4\n\n\nval4\n\n\n\n\n\n\n\n\n\nscratch\n\n(tc/left-join (tc/dataset {:email [\"asdf\"]\n                            :name [\"asdfads\"]\n                            :entry-id [1 2 3]})\n               (tc/dataset {:entry-id [1 2 3]\n                            :upload-count [2 3 4]\n                            :catgory [\"art\" \"science\"]})\n               :entry-id)\n\n\n\n\n\n\nleft-outer-join [3 6]:\n\n\n\n\n\n\n:entry-id\n\n\n:email\n\n\n:name\n\n\n:right.entry-id\n\n\n:upload-count\n\n\n:catgory\n\n\n\n\n\n\n1\n\n\nasdf\n\n\nasdfads\n\n\n1\n\n\n2\n\n\nart\n\n\n\n\n2\n\n\n\n\n\n\n2\n\n\n3\n\n\nscience\n\n\n\n\n3\n\n\n\n\n\n\n3\n\n\n4\n\n\n\n\n\n\n\n\n\n\n\n\n(tc/dataset {:email [\"asdf\"]\n             :name [\"asdfads\"]\n             :entry-id [1 2 3]})\n\n\n\n\n\n\n_unnamed [3 3]:\n\n\n\n\n\n\n:email\n\n\n:name\n\n\n:entry-id\n\n\n\n\n\n\nasdf\n\n\nasdfads\n\n\n1\n\n\n\n\n\n\n\n\n2\n\n\n\n\n\n\n\n\n3\n\n\n\n\n\n\n\n\n\n\n(tc/dataset {:entry-id [1 2 3]\n             :upload-count [2 3 4]\n             :catgory [\"art\" \"science\"]})\n\n\n\n\n\n\n_unnamed [3 3]:\n\n\n\n\n\n\n:entry-id\n\n\n:upload-count\n\n\n:catgory\n\n\n\n\n\n\n1\n\n\n2\n\n\nart\n\n\n\n\n2\n\n\n3\n\n\nscience\n\n\n\n\n3\n\n\n4\n\n\n\n\n\n\n\n\n\n\n\nsee tablecloth join stuff Inner join, only keeps rows with the specified column value in common\n\n(tc/inner-join ds1 ds2 :id)\n\n\n\n\n\n\ninner-join [1 3]:\n\n\n\n\n\n\n:id\n\n\n:b\n\n\n:right.b\n\n\n\n\n\n\nid1\n\n\nval1\n\n\nval4\n\n\n\n\n\n\n\n\n\n\nConverting between wide and long formats? Signal processing/time series analysis\nCompute rolling average to be able to plot a trend line\n\n\n(def exp-moving-avg\n  (let [data (get co2-over-time \"adjusted CO2\")\n        moving-avg\n        (->> data\n             (reduce (fn [acc next]\n                       (conj acc (+ (* 0.9 (last acc)) (* 0.1 next))))\n                     [(first data)])\n             rest)]\n    (tc/dataset [[\"Exponential moving average\" moving-avg]])))\n\n\nwiden dataset to include new row that’s already in order\n\n\n(tc/append co2-over-time exp-moving-avg)\n\n\n\n\n\n\ndata/co2_over_time.csv [741 4]:\n\n\n\n\n\n\nDate\n\n\nCO2\n\n\nadjusted CO2\n\n\nExponential moving average\n\n\n\n\n\n\n1958-03-01\n\n\n315.70\n\n\n314.44\n\n\n314.44000000\n\n\n\n\n1958-04-01\n\n\n317.46\n\n\n315.16\n\n\n314.51200000\n\n\n\n\n1958-05-01\n\n\n317.51\n\n\n314.71\n\n\n314.53180000\n\n\n\n\n1958-07-01\n\n\n315.86\n\n\n315.19\n\n\n314.59762000\n\n\n\n\n1958-08-01\n\n\n314.93\n\n\n316.19\n\n\n314.75685800\n\n\n\n\n1958-09-01\n\n\n313.21\n\n\n316.08\n\n\n314.88917220\n\n\n\n\n1958-11-01\n\n\n313.33\n\n\n315.20\n\n\n314.92025498\n\n\n\n\n1958-12-01\n\n\n314.67\n\n\n315.43\n\n\n314.97122948\n\n\n\n\n1959-01-01\n\n\n315.58\n\n\n315.54\n\n\n315.02810653\n\n\n\n\n1959-02-01\n\n\n316.49\n\n\n315.86\n\n\n315.11129588\n\n\n\n\n…\n\n\n…\n\n\n…\n\n\n…\n\n\n\n\n2019-06-01\n\n\n413.96\n\n\n411.38\n\n\n409.42307506\n\n\n\n\n2019-07-01\n\n\n411.85\n\n\n411.03\n\n\n409.58376755\n\n\n\n\n2019-08-01\n\n\n410.08\n\n\n411.62\n\n\n409.78739079\n\n\n\n\n2019-09-01\n\n\n408.55\n\n\n412.06\n\n\n410.01465172\n\n\n\n\n2019-10-01\n\n\n408.43\n\n\n412.06\n\n\n410.21918654\n\n\n\n\n2019-11-01\n\n\n410.29\n\n\n412.56\n\n\n410.45326789\n\n\n\n\n2019-12-01\n\n\n411.85\n\n\n412.78\n\n\n410.68594110\n\n\n\n\n2020-01-01\n\n\n413.37\n\n\n413.32\n\n\n410.94934699\n\n\n\n\n2020-02-01\n\n\n414.09\n\n\n413.33\n\n\n411.18741229\n\n\n\n\n2020-03-01\n\n\n414.51\n\n\n412.94\n\n\n411.36267106\n\n\n\n\n2020-04-01\n\n\n416.18\n\n\n413.35\n\n\n411.56140396\n\n\n\n\n\n\n\n\n\n\nRolling average over a 12 point range\n\n\n(def rolling-average\n  (tc/dataset [[\"Rolling average\"\n                (-> co2-over-time\n                    (get \"adjusted CO2\")\n                    (rolling/fixed-rolling-window 12\n                                                  fun/mean\n                                                  {:relative-window-position :left}))]]))\n\n\n(tc/append co2-over-time rolling-average)\n\n\n\n\n\n\ndata/co2_over_time.csv [741 4]:\n\n\n\n\n\n\nDate\n\n\nCO2\n\n\nadjusted CO2\n\n\nRolling average\n\n\n\n\n\n\n1958-03-01\n\n\n315.70\n\n\n314.44\n\n\n314.44000000\n\n\n\n\n1958-04-01\n\n\n317.46\n\n\n315.16\n\n\n314.50000000\n\n\n\n\n1958-05-01\n\n\n317.51\n\n\n314.71\n\n\n314.52250000\n\n\n\n\n1958-07-01\n\n\n315.86\n\n\n315.19\n\n\n314.58500000\n\n\n\n\n1958-08-01\n\n\n314.93\n\n\n316.19\n\n\n314.73083333\n\n\n\n\n1958-09-01\n\n\n313.21\n\n\n316.08\n\n\n314.86750000\n\n\n\n\n1958-11-01\n\n\n313.33\n\n\n315.20\n\n\n314.93083333\n\n\n\n\n1958-12-01\n\n\n314.67\n\n\n315.43\n\n\n315.01333333\n\n\n\n\n1959-01-01\n\n\n315.58\n\n\n315.54\n\n\n315.10500000\n\n\n\n\n1959-02-01\n\n\n316.49\n\n\n315.86\n\n\n315.22333333\n\n\n\n\n…\n\n\n…\n\n\n…\n\n\n…\n\n\n\n\n2019-06-01\n\n\n413.96\n\n\n411.38\n\n\n410.14000000\n\n\n\n\n2019-07-01\n\n\n411.85\n\n\n411.03\n\n\n410.38583333\n\n\n\n\n2019-08-01\n\n\n410.08\n\n\n411.62\n\n\n410.63500000\n\n\n\n\n2019-09-01\n\n\n408.55\n\n\n412.06\n\n\n410.88333333\n\n\n\n\n2019-10-01\n\n\n408.43\n\n\n412.06\n\n\n411.08750000\n\n\n\n\n2019-11-01\n\n\n410.29\n\n\n412.56\n\n\n411.26916667\n\n\n\n\n2019-12-01\n\n\n411.85\n\n\n412.78\n\n\n411.48833333\n\n\n\n\n2020-01-01\n\n\n413.37\n\n\n413.32\n\n\n411.69250000\n\n\n\n\n2020-02-01\n\n\n414.09\n\n\n413.33\n\n\n411.89500000\n\n\n\n\n2020-03-01\n\n\n414.51\n\n\n412.94\n\n\n412.10166667\n\n\n\n\n2020-04-01\n\n\n416.18\n\n\n413.35\n\n\n412.32083333\n\n\n\n\n\n\n\n\n\n\nTrain a model to predict the next 10 years\n\n\n(-> co2-over-time\n    )\n\n\n\n\n\n\ndata/co2_over_time.csv [741 3]:\n\n\n\n\n\n\nDate\n\n\nCO2\n\n\nadjusted CO2\n\n\n\n\n\n\n1958-03-01\n\n\n315.70\n\n\n314.44\n\n\n\n\n1958-04-01\n\n\n317.46\n\n\n315.16\n\n\n\n\n1958-05-01\n\n\n317.51\n\n\n314.71\n\n\n\n\n1958-07-01\n\n\n315.86\n\n\n315.19\n\n\n\n\n1958-08-01\n\n\n314.93\n\n\n316.19\n\n\n\n\n1958-09-01\n\n\n313.21\n\n\n316.08\n\n\n\n\n1958-11-01\n\n\n313.33\n\n\n315.20\n\n\n\n\n1958-12-01\n\n\n314.67\n\n\n315.43\n\n\n\n\n1959-01-01\n\n\n315.58\n\n\n315.54\n\n\n\n\n1959-02-01\n\n\n316.49\n\n\n315.86\n\n\n\n\n…\n\n\n…\n\n\n…\n\n\n\n\n2019-06-01\n\n\n413.96\n\n\n411.38\n\n\n\n\n2019-07-01\n\n\n411.85\n\n\n411.03\n\n\n\n\n2019-08-01\n\n\n410.08\n\n\n411.62\n\n\n\n\n2019-09-01\n\n\n408.55\n\n\n412.06\n\n\n\n\n2019-10-01\n\n\n408.43\n\n\n412.06\n\n\n\n\n2019-11-01\n\n\n410.29\n\n\n412.56\n\n\n\n\n2019-12-01\n\n\n411.85\n\n\n412.78\n\n\n\n\n2020-01-01\n\n\n413.37\n\n\n413.32\n\n\n\n\n2020-02-01\n\n\n414.09\n\n\n413.33\n\n\n\n\n2020-03-01\n\n\n414.51\n\n\n412.94\n\n\n\n\n2020-04-01\n\n\n416.18\n\n\n413.35\n\n\n\n\n\n\n\n\n\n\nSummarizing data (mean, standard deviation, confidence intervals etc.)\nStandard deviation using fastmath\n\n\n(def avg-co2-by-year\n  (-> co2-over-time\n      (tc/group-by (fn [row]\n                     (.getYear (get row \"Date\"))))\n      (tc/aggregate {:average-co2 (fn [ds]\n                                    (stats/mean (get ds \"adjusted CO2\"))\n                                    ;; (/ (reduce + (get ds \"CO2\"))\n                                    ;;    (count (get ds \"CO2\")))\n                                    )\n                     :standard-deviation (fn [ds]\n                                           (stats/stddev (get ds \"adjusted CO2\")))})\n      ;; (tc/rename-columns {:$group-name :year})\n      ))\n\n\nOverall average\n\n\n(stats/mean (:average-co2 avg-co2-by-year))\n\n\n355.56414902998233\n\n\nLong term average 1991-2020\n\n\n(-> avg-co2-by-year\n    ;; (tc/select-rows (fn [row] (< 1990 (:year row))))\n    ;; :average-co2\n    ;; mean\n    )\n\n\n\n\n\n\n_unnamed [63 3]:\n\n\n\n\n\n\n:$group-name\n\n\n:average-co2\n\n\n:standard-deviation\n\n\n\n\n\n\n1958\n\n\n315.30000000\n\n\n0.60318204\n\n\n\n\n1959\n\n\n315.97750000\n\n\n0.47259679\n\n\n\n\n1960\n\n\n316.90750000\n\n\n0.42004599\n\n\n\n\n1961\n\n\n317.63833333\n\n\n0.45170049\n\n\n\n\n1962\n\n\n318.44833333\n\n\n0.37201743\n\n\n\n\n1963\n\n\n318.98750000\n\n\n0.28813270\n\n\n\n\n1964\n\n\n319.67888889\n\n\n0.20127372\n\n\n\n\n1965\n\n\n320.03083333\n\n\n0.50883929\n\n\n\n\n1966\n\n\n321.36250000\n\n\n0.37363388\n\n\n\n\n1967\n\n\n322.17500000\n\n\n0.32326460\n\n\n\n\n…\n\n\n…\n\n\n…\n\n\n\n\n2010\n\n\n389.89333333\n\n\n0.67686891\n\n\n\n\n2011\n\n\n391.64500000\n\n\n0.71908401\n\n\n\n\n2012\n\n\n393.86500000\n\n\n0.87383689\n\n\n\n\n2013\n\n\n396.55833333\n\n\n0.72002315\n\n\n\n\n2014\n\n\n398.60500000\n\n\n0.68076828\n\n\n\n\n2015\n\n\n400.87833333\n\n\n1.02130784\n\n\n\n\n2016\n\n\n404.27416667\n\n\n0.95601881\n\n\n\n\n2017\n\n\n406.57750000\n\n\n0.64441834\n\n\n\n\n2018\n\n\n408.58166667\n\n\n0.99862481\n\n\n\n\n2019\n\n\n411.48833333\n\n\n0.74410206\n\n\n\n\n2020\n\n\n413.23500000\n\n\n0.19706175\n\n\n\n\n\n\n\n\n\n\nWorking with sequential data\nSmoothing out data\nCalculating a moving average\nAveraging a sequence in blocks\nRun length encoding?\nFilling nil s with last non-nil value?\n\n\n(def sparse-dataset\n  (tc/dataset {:a [nil 2 3 4 nil nil 7 8]\n               :b [10 11 12 nil nil nil 16 nil]}))\n\n\n(-> sparse-dataset\n    (tc/replace-missing :up))\n\n\n\n\n\n\n_unnamed [8 2]:\n\n\n\n\n\n\n:a\n\n\n:b\n\n\n\n\n\n\n2\n\n\n10\n\n\n\n\n2\n\n\n11\n\n\n\n\n3\n\n\n12\n\n\n\n\n4\n\n\n16\n\n\n\n\n7\n\n\n16\n\n\n\n\n7\n\n\n16\n\n\n\n\n7\n\n\n16\n\n\n\n\n8\n\n\n\n\n\n\n\n\n\n\n\n\n(-> sparse-dataset\n    (tc/replace-missing :updown))\n\n\n\n\n\n\n_unnamed [8 2]:\n\n\n\n\n\n\n:a\n\n\n:b\n\n\n\n\n\n\n2\n\n\n10\n\n\n\n\n2\n\n\n11\n\n\n\n\n3\n\n\n12\n\n\n\n\n4\n\n\n16\n\n\n\n\n7\n\n\n16\n\n\n\n\n7\n\n\n16\n\n\n\n\n7\n\n\n16\n\n\n\n\n8\n\n\n16\n\n\n\n\n\n\n\n\n\n\n(-> sparse-dataset\n    (tc/replace-missing :down))\n\n\n\n\n\n\n_unnamed [8 2]:\n\n\n\n\n\n\n:a\n\n\n:b\n\n\n\n\n\n\n\n\n10\n\n\n\n\n2\n\n\n11\n\n\n\n\n3\n\n\n12\n\n\n\n\n4\n\n\n12\n\n\n\n\n4\n\n\n12\n\n\n\n\n4\n\n\n12\n\n\n\n\n7\n\n\n16\n\n\n\n\n8\n\n\n16\n\n\n\n\n\n\n\n\n\n\n(-> sparse-dataset\n    (tc/replace-missing :downup))\n\n\n\n\n\n\n_unnamed [8 2]:\n\n\n\n\n\n\n:a\n\n\n:b\n\n\n\n\n\n\n2\n\n\n10\n\n\n\n\n2\n\n\n11\n\n\n\n\n3\n\n\n12\n\n\n\n\n4\n\n\n12\n\n\n\n\n4\n\n\n12\n\n\n\n\n4\n\n\n12\n\n\n\n\n7\n\n\n16\n\n\n\n\n8\n\n\n16\n\n\n\n\n\n\n\n\n\n\n(-> sparse-dataset\n    (tc/replace-missing :lerp))\n\n\n\n\n\n\n_unnamed [8 2]:\n\n\n\n\n\n\n:a\n\n\n:b\n\n\n\n\n\n\n2.0\n\n\n10.0\n\n\n\n\n2.0\n\n\n11.0\n\n\n\n\n3.0\n\n\n12.0\n\n\n\n\n4.0\n\n\n13.0\n\n\n\n\n5.0\n\n\n14.0\n\n\n\n\n6.0\n\n\n15.0\n\n\n\n\n7.0\n\n\n16.0\n\n\n\n\n8.0\n\n\n16.0\n\n\n\n\n\n\n\n\n\n\n(-> sparse-dataset\n    (tc/replace-missing :all :value 100))\n\n\n\n\n\n\n_unnamed [8 2]:\n\n\n\n\n\n\n:a\n\n\n:b\n\n\n\n\n\n\n100\n\n\n10\n\n\n\n\n2\n\n\n11\n\n\n\n\n3\n\n\n12\n\n\n\n\n4\n\n\n100\n\n\n\n\n100\n\n\n100\n\n\n\n\n100\n\n\n100\n\n\n\n\n7\n\n\n16\n\n\n\n\n8\n\n\n100\n\n\n\n\n\n\n\n\n\n\n(-> sparse-dataset\n    (tc/replace-missing :a :value 100))\n\n\n\n\n\n\n_unnamed [8 2]:\n\n\n\n\n\n\n:a\n\n\n:b\n\n\n\n\n\n\n100\n\n\n10\n\n\n\n\n2\n\n\n11\n\n\n\n\n3\n\n\n12\n\n\n\n\n4\n\n\n\n\n\n\n100\n\n\n\n\n\n\n100\n\n\n\n\n\n\n7\n\n\n16\n\n\n\n\n8\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nsource: book/chapter_3_data_manipulation/3_data_manipulation.clj"
  },
  {
    "objectID": "chapter_4_data_visualisation/4_2_graphs.html",
    "href": "chapter_4_data_visualisation/4_2_graphs.html",
    "title": "8  Graphs",
    "section": "",
    "text": "(ns chapter-4-data-visualisation.4-2-graphs\n  (:require [tablecloth.api :as tc]\n            [aerial.hanami.common :as hc]\n            [aerial.hanami.templates :as ht]\n            [scicloj.noj.v1.vis.hanami.templates :as vht]\n            [scicloj.noj.v1.vis :as vis]\n            [scicloj.noj.v1.stats :as stats]\n            [scicloj.noj.v1.datasets :as datasets]\n            [tech.v3.datatype :as dtype]\n            [tech.v3.datatype.functional :as fun]\n            [hiccup.core :as hiccup]\n            [clojure2d.color :as color]\n            [tablecloth.api :as tc]))\n\n\n(def co2-over-time (tc/dataset \"data/co2_over_time.csv\"))\n\n\n(-> co2-over-time\n    (vis/hanami-plot ht/line-chart {:X \"Date\"\n                                    :XTYPE \"temporal\"\n                                    :WIDTH 750\n                                    :Y \"adjusted CO2\"\n                                    :YSCALE {:zero false}}))\n\n\n\nvega\n\n\n\n\n(def diamonds datasets/diamonds)\n\n\n(-> diamonds\n    (vis/hanami-plot vht/boxplot-chart {:X :cut\n                                        :XTYPE \"nominal\"\n                                        :Y :price\n                                        :WIDTH 750}))\n\n\n\nvega\n\n\n\n\n\n(-> diamonds\n    (vis/hanami-plot vht/boxplot-chart {:X :color\n                                        :XTYPE \"nominal\"\n                                        :Y :price\n                                        :WIDTH 750}))\n\n\n\nvega\n\n\n\n\n\n(-> diamonds\n    (vis/hanami-plot vht/boxplot-chart {:X :clarity\n                                        :XTYPE \"nominal\"\n                                        :Y :price\n                                        :WIDTH 750}))\n\n\n\nvega\n\n\n\n\n\n:ok\n\n\n:ok\n\n\n\n\n\nsource: book/chapter_4_data_visualisation/4_2_graphs.clj"
  },
  {
    "objectID": "chapter_4_data_visualisation/noj_examples.html#bar-graphs",
    "href": "chapter_4_data_visualisation/noj_examples.html#bar-graphs",
    "title": "9  Graphs with Noj",
    "section": "9.1 Bar graphs",
    "text": "9.1 Bar graphs\n\n(ns chapter-4-data-visualisation.noj-examples\n  (:require [tablecloth.api :as tc]\n            [aerial.hanami.common :as hc]\n            [aerial.hanami.templates :as ht]\n            [scicloj.noj.v1.vis.hanami.templates :as vht]\n            [scicloj.noj.v1.vis :as vis]\n            [scicloj.noj.v1.stats :as stats]\n            [scicloj.noj.v1.datasets :as datasets]\n            [tech.v3.datatype :as dtype]\n            [tech.v3.datatype.functional :as fun]\n            [scicloj.kindly.v4.kind :as kind]\n            [hiccup.core :as hiccup]\n            [clojure2d.color :as color]))"
  },
  {
    "objectID": "chapter_4_data_visualisation/noj_examples.html#raw-html",
    "href": "chapter_4_data_visualisation/noj_examples.html#raw-html",
    "title": "9  Graphs with Noj",
    "section": "9.2 Raw html",
    "text": "9.2 Raw html\n\n(-> \"<p>Hello, <i>Noj</i>.</p>\"\n    vis/raw-html)\n\n\n\n\n\n\n\n(-> [:svg {:height 210\n           :width 500}\n     [:line {:x1 0\n             :y1 0\n             :x2 200\n             :y2 200\n             :style \"stroke:rgb(255,0,0);stroke-width:2\"}]]\n    hiccup/html\n    vis/raw-html)"
  },
  {
    "objectID": "chapter_4_data_visualisation/noj_examples.html#visualizing-datases-with-hanami",
    "href": "chapter_4_data_visualisation/noj_examples.html#visualizing-datases-with-hanami",
    "title": "9  Graphs with Noj",
    "section": "9.3 Visualizing datases with Hanami",
    "text": "9.3 Visualizing datases with Hanami\nNoj offers a few convenience functions to make Hanami plotting work smoothly with Tablecloth and Kindly.\n\n(def random-walk\n  (let [n 20]\n    (-> {:x (range n)\n         :y (->> (repeatedly n #(- (rand) 0.5))\n                 (reductions +))}\n        tc/dataset)))\n\n\n9.3.1 A simple plot\nWe can plot a Tablecloth datasete using a Hanami template:\n\n(-> random-walk\n    (vis/hanami-plot ht/point-chart\n                     {:MSIZE 200}))\n\n\n\nvega\n\n\n\nLet us look inside the resulting vega-lite space. We can see the dataset is included as CSV:\n\n(-> random-walk\n    (vis/hanami-plot ht/point-chart\n                     {:MSIZE 200})\n    kind/pprint)\n\n\n{:encoding\n {:y {:field \"y\", :type \"quantitative\"},\n  :x {:field \"x\", :type \"quantitative\"}},\n :mark {:type \"circle\", :size 200, :tooltip true},\n :width 400,\n :background \"floralwhite\",\n :height 300,\n :data\n {:values\n  \"x,y\\n0,-0.30216713264767825\\n1,-0.4377140270292881\\n2,-0.901067394430808\\n3,-1.0958312946091486\\n4,-1.2202745165647186\\n5,-0.9783604971522069\\n6,-0.6574919485339767\\n7,-0.23315339501986054\\n8,0.07813450117782439\\n9,-0.03861392269881869\\n10,0.2200799152331081\\n11,-0.10745411083199141\\n12,-0.329057218409172\\n13,-0.39338775223057243\\n14,-0.7602530295953795\\n15,-0.8344186942628532\\n16,-0.8680354212911237\\n17,-0.9729585214824985\\n18,-1.0961038960091862\\n19,-1.506030386969417\\n\",\n  :format {:type \"csv\"}}}\n\n\n\n9.3.2 Additional Hanami templates\nThe scicloj.noj.v1.vis.hanami.templates namespace add Hanami templates to Hanami’s own collection.\n\n(-> datasets/mtcars\n    (vis/hanami-plot vht/boxplot-chart\n                     {:X :gear\n                      :XTYPE :nominal\n                      :Y :mpg}))\n\n\n\nvega\n\n\n\n\n\n9.3.3 Layers\n\n(-> random-walk\n    (vis/hanami-layers\n     {:TITLE \"points and a line\"}\n     [(vis/hanami-plot nil\n                       ht/point-chart\n                       {:MSIZE 400})\n      (vis/hanami-plot nil\n                       ht/line-chart\n                       {:MSIZE 4\n                        :MCOLOR \"brown\"})]))\n\n\n\nvega\n\n\n\n\n\n9.3.4 Concatenation\n\n(-> random-walk\n    (vis/hanami-vconcat\n     {}\n     [(vis/hanami-plot nil\n                       ht/point-chart\n                       {:MSIZE 400\n                        :HEIGHT 100\n                        :WIDTH 100})\n      (vis/hanami-plot nil\n                       ht/line-chart\n                       {:MSIZE 4\n                        :MCOLOR \"brown\"\n                        :HEIGHT 100\n                        :WIDTH 100})]))\n\n\n\nvega\n\n\n\n\n(-> random-walk\n    (vis/hanami-hconcat\n     {}\n     [(vis/hanami-plot nil\n                       ht/point-chart\n                       {:MSIZE 400\n                        :HEIGHT 100\n                        :WIDTH 100})\n      (vis/hanami-plot nil\n                       ht/line-chart\n                       {:MSIZE 4\n                        :MCOLOR \"brown\"\n                        :HEIGHT 100\n                        :WIDTH 100})]))\n\n\n\nvega\n\n\n\n\n\n9.3.5 Linear regression\n\n(-> datasets/mtcars\n    (stats/add-predictions :mpg [:wt]\n                           {:model-type :smile.regression/ordinary-least-square})\n    (vis/hanami-layers {}\n                       [(vis/hanami-plot nil\n                                         ht/point-chart\n                                         {:X :wt\n                                          :Y :mpg\n                                          :MSIZE 200\n                                          :HEIGHT 200\n                                          :WIDTH 200})\n                        (vis/hanami-plot nil\n                                         ht/line-chart\n                                         {:X :wt\n                                          :Y :mpg-prediction\n                                          :MSIZE 5\n                                          :MCOLOR \"purple\"\n                                          :YTITLE :mpg})]))\n\n\n\nvega\n\n\n\n\n\n9.3.6 Histogram\n\n(-> datasets/iris\n    (vis/hanami-histogram :sepal-width\n                          {:nbins 10}))\n\n\n\nvega\n\n\n\n\n\n9.3.7 Combining a few things together\nThe following is inspired by the example at Plotnine’s main page. Note how we add regression lines here. We take care of layout and colouring on our side, not using Vega-Lite for that.\n\n(let [pallete (->> :accent\n                   color/palette\n                   (mapv color/format-hex))]\n  (-> datasets/mtcars\n      (tc/group-by :gear {:result-type :as-map})\n      (->> (sort-by key)\n           (map-indexed\n            (fn [i [group-name ds]]\n              (-> ds\n                  (stats/add-predictions :mpg [:wt]\n                                         {:model-type :smile.regression/ordinary-least-square})\n                  (tc/select-columns [:gear :wt :mpg :mpg-prediction])\n                  (vis/hanami-layers {:TITLE (str \"grear=\" group-name)}\n                                     [(vis/hanami-plot nil\n                                                       ht/point-chart\n                                                       {:X :wt\n                                                        :Y :mpg\n                                                        :MSIZE 200\n                                                        :MCOLOR (pallete i)\n                                                        :HEIGHT 200\n                                                        :WIDTH 200})\n                                      (vis/hanami-plot nil\n                                                       ht/line-chart\n                                                       {:X :wt\n                                                        :Y :mpg-prediction\n                                                        :MSIZE 5\n                                                        :MCOLOR (pallete i)\n                                                        :YTITLE :mpg})]\n                                     ))))\n           (vis/hanami-vconcat nil {}))))\n\n\n\nvega\n\n\n\nA similar example with histograms:\n\n(let [pallete (->> :accent\n                   color/palette\n                   (mapv color/format-hex))]\n  (-> datasets/iris\n      (tc/group-by :species {:result-type :as-map})\n      (->> (sort-by key)\n           (map-indexed\n            (fn [i [group-name ds]]\n              (-> ds\n                  (vis/hanami-histogram :sepal-width\n                                        {:nbins 10}))))\n           (vis/hanami-vconcat nil {}))))\n\n\n\nvega\n\n\n\nScatterplots and regression lines again, this time using Vega-Lite for layout and coloring (using its “facet” option).\n\n(-> datasets/mtcars\n    (tc/group-by [:gear])\n    (stats/add-predictions :mpg [:wt]\n                           {:model-type :smile.regression/ordinary-least-square})\n    (tc/ungroup)\n    (tc/select-columns [:gear :wt :mpg :mpg-prediction])\n    (vis/hanami-layers {}\n                       [(vis/hanami-plot nil\n                                         ht/point-chart\n                                         {:X :wt\n                                          :Y :mpg\n                                          :MSIZE 200\n                                          :COLOR \"gear\"\n                                          :HEIGHT 100\n                                          :WIDTH 200})\n                        (vis/hanami-plot nil\n                                         ht/line-chart\n                                         {:X :wt\n                                          :Y :mpg-prediction\n                                          :MSIZE 5\n                                          :COLOR \"gear\"\n                                          :YTITLE :mpg})])\n    ((fn [spec]\n       {:facet {:row {:field \"gear\"}}\n        :spec (dissoc spec :data)\n        :data (:data spec)}))\n    kind/vega-lite)\n\n\n\nvega\n\n\n\n\n:bye\n\n\n:bye\n\n\n\n\n\nsource: /home/daslu/projects/scicloj/clojure-data-cookbook/book/chapter_4_data_visualisation/noj_examples.clj"
  },
  {
    "objectID": "chapter_1_intro/1_1_welcome.html",
    "href": "chapter_1_intro/1_1_welcome.html",
    "title": "2  Welcome",
    "section": "",
    "text": "(ns chapter-1-intro.1-1-welcome\n  {:nextjournal.clerk/visibility {:code :hide}\n   :nextjournal.clerk/toc true})\nWelcome to the Clojure Data Cookbook! This is a resource for people with data to work with who want to explore what Clojure can do. Clojure is among the most stable, most loved, and most lucrative languages out there, but is not often thought of as a language for data science.\nClojure is free, open source, and has excellent performance thanks to being hosted on the JVM. There are thousands of libraries available for Clojure, in addition to the endless Java libraries that are seamlessly available in Clojure, too.\nApproaching a new Clojure project can be intimidating, though. It’s not always obvious where to start. It’s not even clear which libraries you’ll need, or which ones do what. The Clojure community in general tends to favour bespoke, minimalist configurations that are unique for every project. There are good reasons for this. It tends to lead to more maintainable, more stable code, in the long run. But it does have the major downside of making it harder to get started.\nClojure and its ecosystem are very much optimized for long-term, professional use, which makes it a great fit for mission-critical projects with no room to compromise on performance or security, but this lack of frameworks and batteries-included solutions can make it feel intimidating for newcomers.\nClojure’s story for data science is no different. In recent years a lot of amazing work has been done by the community that makes Clojure a great choice for many data-focused tasks, but it’s not always obvious where to start.\nThis book is a guide through Clojure’s ecosystem for data science. It includes some introductory tutorials on getting a Clojure environment set up, a brief overview of the most relevant parts of the Clojure language itself, and most importantly, a comprehensive collection of example-based explanations of which libraries to use and how to use them to accomplish common tasks in data science using Clojure. We’ll cover data input and output, manipulation, visualisation, and finally analysis, including many common statistical analyses. The examples include a brief introduction to the type of problem we’re solving, the solution itself, and in most cases an explanation of what the solution is doing. The goal is to provide insight into how to think like a Clojurian and solve problems “the Clojure way”.\nThe examples in this book can be copy/pasted into a notebook on your own computer and should run there so you can see how they work. Continue reading this chapter for more details on how to set up a working Clojure environment on your own computer.\nThis book assumes some basic prior knowledge of data science but not necessarily Clojure. This is meant to be a guide to demonstrate what tools are available in Clojure’s ecosystem for working with data, starting with the assumption that most people do not think of Clojure as an obvious choice for data science. It is not an introduction to statistics. The examples assume you are familiar with the underlying statistical method and offer an example implementation in Clojure."
  }
]